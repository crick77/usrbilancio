<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="jakarta.faces.core"
                xmlns:h="jakarta.faces.html"
                xmlns:ui="jakarta.faces.facelets"
                xmlns:p="primefaces"
                template="/WEB-INF/template.xhtml">

    <ui:define name="title">Registro operazioni</ui:define>

    <ui:define name="head">
        <f:metadata>
            <f:viewAction action="#{logOpController.init()}" />
        </f:metadata>           
    </ui:define>

    <ui:define name="content">
        <h:form id="form" enctype="multipart/form-data">
            <p:tooltip />
            <p:growl id="msg" showDetail="true" escape="false"/>

            <h:panelGroup id="page" layout="block" styleClass="grid">
                <div class="col-12 md:col-12 lg:col-12">
                    <p:panel header="REGISTRO OPERAZIONI">
                        <div class="col-12">
                            <p:dataTable id='logopTable' value="#{logOpController.log}" var='l' paginator="true" rows="10" paginatorPosition="bottom" paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" 
                                         currentPageReportTemplate="{startRecord}-{endRecord} di {totalRecords} voci" rowsPerPageTemplate="5,10,{ShowAll|'Tutti'}" widgetVar="wvLogopTable" rowKey="#{l.id}" stripedRows="true" selectionMode="single"
                                         selection="#{logOpController.logSelezionato}" size="small" filteredValue="#{logOpController.logFiltrati}">
                                <p:column style="width:2rem" ariaHeaderText="Row Toggler">
                                    <p:rowToggler/>
                                </p:column>
                                <p:column headerText="SERVIZIO/FUNZIONE" filterMatchMode="exact" field="service" sortable="true">
                                    <f:facet name="filter">
                                        <p:selectOneMenu value="#{logOpController.servizioFiltro}" panelStyle="width:400px" filter="true" filterMatchMode="contains" var="serv" onchange="PF('wvLogopTable').filter()" style="min-width: 100% !important" styleClass="custom-filter" >
                                            <f:selectItem itemValue="#{null}" itemLabel="*" noSelectionOption="true" />
                                            <f:selectItems value="#{logOpController.servizi}" var="s" itemValue="#{s}" itemLabel="#{s}" />

                                            <p:column>
                                                <h:outputText value="#{serv}" />
                                            </p:column>                                       
                                        </p:selectOneMenu>
                                    </f:facet>

                                    #{l.service}
                                </p:column>                                
                                <p:column headerText="OPERATORE" style="width: 10%" filterMatchMode="exact" field="operatore" sortable="true">
                                    <f:facet name="filter">
                                        <p:selectOneMenu value="#{logOpController.operatoreFiltro}" panelStyle="width:400px" filter="true" filterMatchMode="contains" var="op" onchange="PF('wvLogopTable').filter()" style="min-width: 100% !important" styleClass="custom-filter" >
                                            <f:selectItem itemValue="#{null}" itemLabel="*" noSelectionOption="true" />
                                            <f:selectItems value="#{logOpController.operatori}" var="o" itemValue="#{o}" itemLabel="#{o}" />

                                            <p:column>
                                                <h:outputText value="#{op}" />
                                            </p:column>                                       
                                        </p:selectOneMenu>
                                    </f:facet>
                                    
                                    #{l.operatore}
                                </p:column>
                                <p:column headerText="DATA/ORA" style="width: 9%" filterMatchMode="between" field="dataOra" sortable="true" sortBy="#{l.dataOra}" sortOrder="desc">
                                    <f:facet name="filter">
                                        <p:datePicker selectionMode="range" converter="localDateTimeConverter" onchange="PF('wvLogopTable').filter()" onblur="PF('wvLogopTable').filter()" monthNavigator="true" yearNavigator="true" mask="true" pattern="dd-MM-yyyy" showOnFocus="false" />
                                    </f:facet>
                                    <h:outputText value="#{l.dataOra}">
                                        <f:convertDateTime pattern="dd-MM-yyyy HH:mm:ss" type="localDateTime" timeZone="Europe/Rome" />
                                    </h:outputText>
                                </p:column>

                                <p:rowExpansion>
                                    <div class="grid">
                                        <table class="reset" style="border-collapse: separate">
                                            <thead>
                                                <tr>
                                                    <th class="detail">ARG1/NUOVO</th>
                                                    <th class="detail">ARG2</th>
                                                    <th class="detail">ARG2</th>
                                                    <th class="detail">ARG3</th>
                                                    <th class="detail">ARG4</th>
                                                    <th class="detail">ARG5/ORIGINALE</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td class="detail">#{l.arg1}</td>
                                                    <td class="detail">#{l.arg2}</td>
                                                    <td class="detail">#{l.arg3}</td>
                                                    <td class="detail">#{l.arg4}</td>
                                                    <td class="detail">#{l.arg5}</td>
                                                    <td class="detail">#{l.originale}</td>                                                
                                                </tr>
                                                <tr>
                                                    <td class="detail" colspan="6">Diff</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </p:rowExpansion>
                            </p:dataTable>
                        </div>
                        <div class="col-1">
                            <p:commandButton id="aggiornaLogOp" value="Aggiorna" styleClass="ui-button-secondary" icon="pi pi-refresh" action="#{logOpController.aggiornaLog()}" process="@this" update="@form" />
                        </div>
                    </p:panel>
                </div>
            </h:panelGroup>
        </h:form>
    </ui:define>

</ui:composition>